import{b as ae,E as oe,q as se,f as ne,d as ie,e as re,h as ue,i as ce,j as de,k as me}from"./element-plus-8efUW2IF.js";import{_ as pe}from"./GWSearchCondition-Bf1Cgcsf.js";import{_ as B,g as q,a as ve}from"./index-48jvUbNQ.js";import{u as fe}from"./vue-router-DaOdIdNP.js";import{m as _e,p as ge,a as he,b as ye,c as xe}from"./movie-BDTxE_K0.js";import{c as m,D as we,o as c,d as W,I as ke,r as n,h as G,a as r,u as f,S as be,M,a7 as E,Q as I,P as i,U as R,L as s,ab as Ve,H as Ce,w as Ne,b as ze,V as Se,T as L,at as Fe,au as Me}from"./@vue-BV9Q_yhH.js";import{P as Ue}from"./index-4a45O58F.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-Bxelk99Q.js";import"./file-saver-CJAWeVrG.js";const $e={},Ee={class:"gw-flex-container"};function Ie(p,d){return c(),m("div",Ee,[we(p.$slots,"flex-items",{},void 0,!0)])}const Re=B($e,[["render",Ie],["__scopeId","data-v-55ab031e"]]),Ae={class:"gw-flex-item"},Be={class:"gw-flex-card"},De={class:"img-card"},Te=["src"],Pe=["fileName"],qe={class:"gw-flex-info"},Ge={class:"movie-title"},Le=W({__name:"GWFlexMovieCard",props:{movie:{},click:{type:Function}},setup(p){const d=p,{movie:a}=ke(d),k=n(a.value.previewUrl),h=n(a.value.title),b=n(!1);let V=G(()=>{if(a.value.size){if(a.value.series=="是")return" [共"+a.value.size+"集]";{let e=a.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function U(){if(d!=null&&d.click){const e=Ve(a.value);d.click(e)}}function C(){b.value=!b.value}function N(e){const u=e.target;h.value=a.value.title+"_"+u.innerHTML,k.value=a.value.previewUrl+"/"+u.getAttribute("fileName"),z()}function z(){Ue.previewVideo(q()+k.value,h.value)}let y=G(()=>{if(a.value.files)return a.value.files.map(e=>{const[u,x]=e.name.split("-");return{...e,chapter:u,title:x}})});return(e,u)=>{const x=ae;return c(),m("div",Ae,[r("div",Be,[r("div",De,[r("img",{onclick:U,src:f(q)()+f(a).coverUrl,onerror:"this.onerror=null;this.src='';",alt:"Sorry, something went wrong"},null,8,Te),r("div",{class:"overlay",style:be({display:b.value?"flex":"none"})},[(c(!0),m(M,null,E(f(y),(v,S)=>(c(),I(x,{class:"item",effect:"dark",content:v.title,placement:"top",key:S},{default:i(()=>[r("div",{class:"overlay-item",onclick:N,fileName:v.value},R(v.chapter),9,Pe)]),_:2},1032,["content"]))),128))],4)]),r("div",qe,[s(x,{class:"item",effect:"dark",content:f(a).title+f(V),placement:"bottom"},{default:i(()=>[r("h3",Ge,R(f(a).title)+R(f(V)),1)]),_:1},8,["content"]),f(a).series=="是"?(c(),m("h3",{key:0,class:"movie-play",onclick:C}," 剧集 ")):(c(),m("h3",{key:1,class:"movie-play",onclick:z},"Play"))])])])}}}),We=B(Le,[["__scopeId","data-v-cea03907"]]),j=p=>(Fe("data-v-5f5e935d"),p=p(),Me(),p),je={class:"movie-root-container"},He={class:"flex-item"},Ke={class:"flex-item"},Oe=j(()=>r("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),Qe={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Je={class:"flex-item",style:{"margin-left":"20px"}},Xe=j(()=>r("span",{width:"30px"},null,-1)),Ye={key:0,style:{width:"100%","margin-top":"1rem"}},Ze=W({__name:"Movie",setup(p){fe();const d=n(0),a=n(1),k=n(2),h=n([]),b=n(!1),V=n(),U=n(),C=n(),N=n(),z=n(),y=n(),e=n(),u=n({name:"",folderName:"",url:""}),x=Ce({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),v=n(!1),S=()=>{v.value=!1},H=()=>{v.value=!0},K=async o=>{o&&await o.validate(async(t,_)=>{t?(ye(u.value),S()):console.log("error submit!",_)})},O=o=>{V.value=o.title,U.value=o.previewUrl,C.value=o.id,D.value.click()},Q=o=>{V.value=o.name,U.value=o.url,b.value=!0},J=o=>{a.value=o,A()},A=async()=>{await ge({pageNo:a.value,pageSize:k.value,folderName:y.value,name:e.value}).then(o=>{h.value=o.data.result,d.value=o.data.total})},D=n(),X=async o=>{if(C.value){const t=o.target;if(t.files&&t.files[0]){const _=new FileReader;_.onload=g=>{var F;(F=g.target)==null||F.result},_.readAsDataURL(t.files[0]);let w=new FormData;w.append("file",t.files[0]),w.append("id",C.value+""),await he(w).then(g=>{g.data&&oe({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}};Ne(()=>[y.value,e.value],()=>{A()},{deep:!0,immediate:!0});const Y=()=>{xe()};return ze(async()=>{A(),await _e({type:1}).then(o=>{N.value=o.data})}),(o,t)=>{var P;const _=ie,w=re,g=ue,F=ve,Z=pe,ee=se,$=ce,T=de,le=me,te=ne;return c(),m(M,null,[r("div",je,[s(Z,null,{"left-items":i(()=>[r("div",He,[s(w,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=l=>y.value=l),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:i(()=>[(c(!0),m(M,null,E(N.value,l=>(c(),I(_,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(g,{style:{"margin-left":"10px"},modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value=l),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":i(()=>[r("div",Ke,[Oe,r("span",Qe,R(d.value),1),r("div",Je,[s(F,{size:"20px","icon-class":"m3u8",class:"svg-icon",onclick:H}),Xe,s(F,{size:"20px","icon-class":"refresh",class:"svg-icon",onclick:Y})])])]),_:1}),s(Re,{style:{"justify-content":"space-around"}},{"flex-items":i(()=>[(c(!0),m(M,null,E(h.value,(l,el)=>(c(),I(We,{click:O,play:Q,movie:l,key:l.id},null,8,["movie"]))),128))]),_:1}),((P=h.value)==null?void 0:P.length)>0?(c(),m("div",Ye,[s(ee,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:d.value,"pager-count":5,"page-size":k.value,"current-page":a.value,onCurrentChange:J},null,8,["total","page-size","current-page"])])):Se("",!0),r("input",{ref_key:"fileselectRef",ref:D,style:{display:"none"},type:"file",accept:"image/*",onChange:X},null,544)]),s(te,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=l=>v.value=l),width:"500px",onClose:S},{default:i(()=>[s(le,{ref_key:"m3u8FormRef",ref:z,model:u.value,"label-width":"auto",rules:x},{default:i(()=>[s($,{label:"电影名称：",prop:"name"},{default:i(()=>[s(g,{modelValue:u.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>u.value.name=l),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),s($,{label:"所属分类：",prop:"folderName"},{default:i(()=>[s(w,{modelValue:u.value.folderName,"onUpdate:modelValue":t[3]||(t[3]=l=>u.value.folderName=l),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:i(()=>[(c(!0),m(M,null,E(N.value,l=>(c(),I(_,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s($,{label:"解析地址：",prop:"url"},{default:i(()=>[s(g,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:u.value.url,"onUpdate:modelValue":t[4]||(t[4]=l=>u.value.url=l),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),s($,{style:{"flex-direction":"column"}},{default:i(()=>[s(T,{onClick:S},{default:i(()=>[L("取消")]),_:1}),s(T,{type:"primary",onClick:t[5]||(t[5]=l=>K(z.value))},{default:i(()=>[L("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),xl=B(Ze,[["__scopeId","data-v-5f5e935d"]]);export{xl as default};
