var d=Object.defineProperty;var f=(s,t,e)=>t in s?d(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(f(s,typeof t!="symbol"?t+"":t,e),e);import{a as m}from"./axios-Cm0UX6qg.js";import{g,L as p,s as h,i as n,u as R,r as b,t as j}from"./index-DMPKi-3R.js";import{E as c}from"./element-plus-8efUW2IF.js";const q=g();class P{constructor(t){o(this,"instance");o(this,"baseConfig",{baseURL:q,timeout:6e4});this.instance=m.create(Object.assign(this.baseConfig,t)),this.instance.interceptors.request.use(e=>{let r="",a=p.get(h);return n(a)&&n(a.token)&&(r=a.token),e.headers={...e.headers,Authorization:"Bearer "+r},e},e=>Promise.reject(e)),this.instance.interceptors.response.use(e=>{e.status!==200&&Promise.reject(e);let a=!1;if((e.config.responseType==="blob"||e.headers["content-type"]==="application/force-download")&&(n(e.data.code)?u(e.data.code)||(a=!1):a=!0),u(e.data.code)&&(a=!0),a)return e.data;if(e.data.code==="20002"||e.data.code===20002){console.log("授权失败, 重置登录状态"),R().reset();const l=b.currentRoute.value;return j({name:"Login",query:{redirect:l.name}}),Promise.reject(e)}else{let i=e.data;return i.url=e.config.url,c({message:e.data.message,duration:9999}),Promise.reject(e)}},e=>{let r=e.message;return e.code==="ERR_NETWORK"&&(r="网络错误,请检查您的网络是否通畅"),c({message:r}),Promise.reject(e)})}request(t){return this.instance.request(t)}get(t,e){return this.instance.get(t,e)}post(t,e,r){return this.instance.post(t,e,r)}delete(t,e){return this.instance.delete(t,e)}}const u=s=>s===0||s==="0"||s===2e4||s==="20000",E=new P;export{E as d};
