import{b as ae,E as oe,q as se,f as ne,d as ie,e as re,h as ue,i as ce,j as de,k as me}from"./element-plus-8efUW2IF.js";import{_ as pe}from"./GWSearchCondition-D6XFZzGq.js";import{_ as D,g as G,a as ve}from"./index-n7s-xaBh.js";import{u as fe}from"./vue-router-DaOdIdNP.js";import{m as _e,p as ge,a as he,b as ye,c as xe}from"./movie-MH4HqPBh.js";import{c,D as we,o as i,d as j,I as ke,r as n,h as L,a as u,u as v,S as be,M as b,a7 as E,Q as A,P as r,U as $,L as s,ab as Ve,H as Ne,w as Ce,b as ze,V as Se,T as W,at as Fe,au as Me}from"./@vue-BV9Q_yhH.js";import{P as Ue}from"./index-Dk_kVG1O.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-9FyxBu7V.js";import"./file-saver-CJAWeVrG.js";const $e={},Ee={class:"gw-flex-container"};function Ie(f,d){return i(),c("div",Ee,[we(f.$slots,"flex-items",{},void 0,!0)])}const Re=D($e,[["render",Ie],["__scopeId","data-v-55ab031e"]]),Ae={class:"gw-flex-item"},Be={class:"gw-flex-card"},De={class:"img-card"},Te=["src"],Pe=["fileName"],qe=["fileName"],Ge={class:"gw-flex-info"},Le={class:"movie-title"},We=j({__name:"GWFlexMovieCard",props:{movie:{},click:{type:Function}},setup(f){const d=f,{movie:a}=ke(d),V=n(a.value.previewUrl),w=n(a.value.title),N=n(!1),C=n(!0);let z=L(()=>{if(a.value.size){if(a.value.series=="是")return" [共"+a.value.size+"集]";{let e=a.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function S(){if(d!=null&&d.click){const e=Ve(a.value);d.click(e)}}function F(){N.value=!N.value}function M(e){const h=e.target;w.value=a.value.title+"_"+h.innerHTML,V.value=a.value.previewUrl+"/"+h.getAttribute("fileName"),_()}function _(){Ue.previewVideo(G()+V.value,w.value)}let g=L(()=>{if(a.value.files)return a.value.files.map(e=>{const[h,m]=e.name.split("-");return m||(C.value=!1),{...e,chapter:h,title:m}})});return(e,h)=>{const m=ae;return i(),c("div",Ae,[u("div",Be,[u("div",De,[u("img",{onclick:S,src:v(G)()+v(a).coverUrl,onerror:"this.onerror=null;this.src='';",alt:"Sorry, something went wrong"},null,8,Te),u("div",{class:"overlay",style:be({display:N.value?"flex":"none"})},[C.value?(i(!0),c(b,{key:0},E(v(g),(p,I)=>(i(),A(m,{class:"item",effect:"dark",content:p.title,placement:"top",key:I},{default:r(()=>[u("div",{class:"overlay-item",onclick:M,fileName:p.value},$(p.chapter),9,Pe)]),_:2},1032,["content"]))),128)):(i(!0),c(b,{key:1},E(v(g),(p,I)=>(i(),c("div",{class:"overlay-item",onclick:M,fileName:p.value},$(p.chapter),9,qe))),256))],4)]),u("div",Ge,[s(m,{class:"item",effect:"dark",content:v(a).title+v(z),placement:"bottom"},{default:r(()=>[u("h3",Le,$(v(a).title)+$(v(z)),1)]),_:1},8,["content"]),v(a).series=="是"?(i(),c("h3",{key:0,class:"movie-play",onclick:F}," 剧集 ")):(i(),c("h3",{key:1,class:"movie-play",onclick:_},"Play"))])])])}}}),je=D(We,[["__scopeId","data-v-d28f3d7c"]]),H=f=>(Fe("data-v-34fe2e92"),f=f(),Me(),f),He={class:"movie-root-container"},Ke={class:"flex-item"},Oe={class:"flex-item"},Qe=H(()=>u("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),Je={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Xe={class:"flex-item",style:{"margin-left":"20px"}},Ye=H(()=>u("span",{width:"30px"},null,-1)),Ze={key:0,style:{width:"100%","margin-top":"1rem"}},el=j({__name:"Movie",setup(f){fe();const d=n(0),a=n(1),V=n(8),w=n([]),N=n(!1),C=n(),z=n(),S=n(),F=n(),M=n(),_=n(),g=n(),e=n({name:"",folderName:"",url:""}),h=Ne({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),m=n(!1),p=()=>{m.value=!1},I=()=>{m.value=!0},K=async o=>{o&&await o.validate(async(t,y)=>{t?(ye(e.value),p()):console.log("error submit!",y)})},O=o=>{C.value=o.title,z.value=o.previewUrl,S.value=o.id,T.value.click()},Q=o=>{C.value=o.name,z.value=o.url,N.value=!0},J=o=>{a.value=o,B()},B=async()=>{await ge({pageNo:a.value,pageSize:V.value,folderName:_.value,name:g.value}).then(o=>{w.value=o.data.result,d.value=o.data.total})},T=n(),X=async o=>{if(S.value){const t=o.target;if(t.files&&t.files[0]){const y=new FileReader;y.onload=x=>{var U;(U=x.target)==null||U.result},y.readAsDataURL(t.files[0]);let k=new FormData;k.append("file",t.files[0]),k.append("id",S.value+""),await he(k).then(x=>{x.data&&oe({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}};Ce(()=>[_.value,g.value],()=>{B()},{deep:!0,immediate:!0});const Y=()=>{xe()};return ze(async()=>{B(),await _e({type:1}).then(o=>{F.value=o.data})}),(o,t)=>{var q;const y=ie,k=re,x=ue,U=ve,Z=pe,ee=se,R=ce,P=de,le=me,te=ne;return i(),c(b,null,[u("div",He,[s(Z,null,{"left-items":r(()=>[u("div",Ke,[s(k,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=l=>_.value=l),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:r(()=>[(i(!0),c(b,null,E(F.value,l=>(i(),A(y,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(x,{style:{"margin-left":"10px"},modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":r(()=>[u("div",Oe,[Qe,u("span",Je,$(d.value),1),u("div",Xe,[s(U,{size:"20px","icon-class":"m3u8",class:"svg-icon",onclick:I}),Ye,s(U,{size:"20px","icon-class":"refresh",class:"svg-icon",onclick:Y})])])]),_:1}),s(Re,{style:{"justify-content":"space-around"}},{"flex-items":r(()=>[(i(!0),c(b,null,E(w.value,(l,ll)=>(i(),A(je,{click:O,play:Q,movie:l,key:l.id},null,8,["movie"]))),128))]),_:1}),((q=w.value)==null?void 0:q.length)>0?(i(),c("div",Ze,[s(ee,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:d.value,"pager-count":5,"page-size":V.value,"current-page":a.value,onCurrentChange:J},null,8,["total","page-size","current-page"])])):Se("",!0),u("input",{ref_key:"fileselectRef",ref:T,style:{display:"none"},type:"file",accept:"image/*",onChange:X},null,544)]),s(te,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=l=>m.value=l),width:"500px",onClose:p},{default:r(()=>[s(le,{ref_key:"m3u8FormRef",ref:M,model:e.value,"label-width":"auto",rules:h},{default:r(()=>[s(R,{label:"电影名称：",prop:"name"},{default:r(()=>[s(x,{modelValue:e.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.name=l),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),s(R,{label:"所属分类：",prop:"folderName"},{default:r(()=>[s(k,{modelValue:e.value.folderName,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.folderName=l),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:r(()=>[(i(!0),c(b,null,E(F.value,l=>(i(),A(y,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(R,{label:"解析地址：",prop:"url"},{default:r(()=>[s(x,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:e.value.url,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.url=l),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),s(R,{style:{"flex-direction":"column"}},{default:r(()=>[s(P,{onClick:p},{default:r(()=>[W("取消")]),_:1}),s(P,{type:"primary",onClick:t[5]||(t[5]=l=>K(M.value))},{default:r(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),wl=D(el,[["__scopeId","data-v-34fe2e92"]]);export{wl as default};
